# Implementation Plan

## 実装タスク

- [x] 1. エピソードソース選択モーダルの実装 (P)
- [x] 1.1 (P) 基本的なソース選択UIコンポーネントの作成

  - エピソード追加方法選択ダイアログの基本構造を実装
  - ファイル追加とYouTube動画追加の2つのオプションボタンを配置
  - Flowbite Svelteモーダルコンポーネントを使用したレイアウト
  - プロパティとイベントハンドラーのインターフェース定義
  - _Requirements: 要件1_

- [x] 1.2 (P) ソース選択の状態管理とイベント処理

  - ソース選択結果の親ページへの通知機能
  - モーダルの開閉状態管理
  - キャンセル時の適切な状態リセット処理
  - ユーザー選択時のコールバック実行
  - _Requirements: 要件1_

- [x] 2. ファイルエピソード追加モーダルの実装 (P)
- [x] 2.1 (P) ファイル専用追加ダイアログの作成

  - ファイルベースエピソード追加に特化したモーダルUI
  - 音声ファイルとスクリプトファイル選択機能のみを含む構造
  - YouTube関連要素を一切含まないクリーンな実装
  - `FileEpisodeForm`コンポーネントとの統合
  - _Requirements: 要件2_

- [x] 2.2 (P) ファイル追加機能とバリデーションの統合

  - TSV設定、TTS設定、スクリプト言語検出機能の組み込み
  - ファイル追加完了時のエピソード作成とダイアログクローズ
  - エラー発生時の適切なエラーメッセージ表示
  - 既存`fileEpisodeAddStore`との状態連携
  - _Requirements: 要件2_

- [x] 3. YouTubeエピソード追加モーダルの実装 (P)
- [x] 3.1 (P) YouTube専用追加ダイアログの作成

  - YouTubeベースエピソード追加に特化したモーダルUI
  - URL入力とメタデータ取得機能のみを含む構造
  - ローカルファイル関連要素を一切含まないクリーンな実装
  - `YoutubeEpisodeForm`コンポーネントとの統合
  - _Requirements: 要件3_

- [x] 3.2 (P) YouTube追加機能とメタデータ処理の統合

  - 自動字幕取得、言語設定、品質選択機能の組み込み
  - YouTube動画追加完了時のエピソード作成とダイアログクローズ
  - エラー発生時の適切なエラーメッセージ表示
  - 既存`youtubeEpisodeAddStore`との状態連携
  - _Requirements: 要件3_

- [x] 4. エピソードリストページでの統合モーダル制御システムの実装
- [x] 4.1 モーダル状態管理コントローラーの作成

  - 3つのモーダル間の状態遷移を管理するコントローラー実装
  - ソース選択→専用ダイアログの適切な制御フロー
  - Flowbite Svelteの制約を考慮したモーダル間遷移の実装
  - モーダル開閉とユーザーアクションの状態追跡
  - _Requirements: 要件1, 要件4_

- [x] 4.2 エピソード追加ワークフローの統合

  - 既存`addNewEpisode`ユースケースとの連携
  - ファイルとYouTubeの両方の追加フローを統一的に処理
  - エピソード作成完了後のUI状態リセット
  - エラーハンドリングと復旧処理の実装
  - _Requirements: 要件4, 要件6_

- [x] 5. 独立性確保とアーキテクチャ分離の実装
- [x] 5.1 ダイアログ間の依存関係除去

  - ファイル追加ダイアログがYouTube関連ストア・ロジックに依存しないことの確認
  - YouTube追加ダイアログがファイル関連ストア・ロジックに依存しないことの確認
  - 各ダイアログの独立したSvelteコンポーネントとしての実装
  - エラー隔離の実装（一方のダイアログエラーが他方に影響しない）
  - _Requirements: 要件4_

- [x] 5.2 独立したストア使用の確立

  - `fileEpisodeAddStore`と`youtubeEpisodeAddStore`の独立利用
  - 各ストア間の状態共有や依存の完全な除去
  - ストア初期化と破棄の独立実行
  - 状態管理の完全分離の検証
  - _Requirements: 要件4_

- [x] 6. 統合テストの実装
- [x] 6.1 ソース選択モーダルの統合テスト作成

  - ファイルとYouTube選択肢の表示テスト
  - ファイル選択時のFileEpisodeAddModal開放テスト
  - YouTube選択時のYoutubeEpisodeAddModal開放テスト
  - キャンセルとオーバーレイクリック動作のテスト
  - _Requirements: 要件1_

- [x] 6.2 YouTubeエピソード追加モーダルの統合テスト作成

  - YouTubeEpisodeFormコンポーネントのレンダリングテスト
  - URL入力とバリデーション動作のテスト
  - メタデータ取得とエピソード作成のテスト
  - エラーハンドリングとキャンセル動作のテスト
  - _Requirements: 要件3_

- [ ] 7. 旧システムの削除とクリーンアップ
- [x] 7.1 統合コンポーネント・ストアの削除

  - `EpisodeAddModal`コンポーネントの完全削除
  - `episodeAddStore`（統合ストア）の完全削除
  - 削除対象への全参照の除去
  - ビルドプロセスでの警告・エラー除去の確認
  - _Requirements: 要件5_

- [ ] 7.2 互換性検証と最終テスト

  - 新ダイアログ群が既存`addNewEpisode`ユースケースとのAPI契約維持
  - TSV設定、TTS設定、自動字幕取得、メタデータ処理機能の完全サポート確認
  - 作成エピソードデータの既存形式との互換性検証
  - 既存テストケースの合格確認
  - _Requirements: 要件6_
